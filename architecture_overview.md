\n# System Architecture Overview (Block Diagram)\n\nThis diagram provides a high-level overview of the Car Insurance Claims AI Agent, showing the main components and their interactions.\n\n```mermaid\ngraph TD\n    subgraph User_Interaction[User Interaction]\n        User[Client / User] --> API_GW[FastAPI Application Gateway (run.py)];\n    end\n\n    subgraph FastAPI_Application [FastAPI Application (src/)]\n        API_GW --> Routes[API Routes (src/api/routes.py)];\n        Routes --> DamageService[Damage Assessment Service (src/services/groq_service.py)];\n        Routes --> ReportService[Accident Report Service (src/services/accident_report_service.py)];\n    end\n\n    subgraph Core_Services_Utils [Core Services & Utilities (src/)]\n        DamageService --> GroqClient[Groq API Client];\n        ReportService --> GroqClient;\n        ReportService --> OCR[OCR Utils (src/utils/ocr_utils.py)];\n        \n        ReportService --> ImageProc[Image Processing Utils (src/utils/image_utils.py)];\n        DamageService --> ImageProc;\n        Routes --> ImageProc;\n        \n        Routes --> Fraud[Fraud Detection Utils (src/utils/fraud_detection.py)];\n        DamageService --> Fraud;\n        ReportService --> Fraud;\n        \n        DamageService --> DamageSchemas[Damage Schemas (src/schemas/damage_assessment_enhanced.py)];\n        ReportService --> ReportSchemas[Accident Report Schemas (src/schemas/accident_report_de/en/nl.py)];\n        Routes --> ReportSchemas; \n        Routes --> DamageSchemas;\n    end\n\n    subgraph External_Services [External Services]\n        GroqClient --> GroqCloud[Groq Cloud LLM API];\n        OCR --> ExternalOCR[External/Internal OCR Engine (Implied by OpenCV, Tesseract etc.)];\n    end\n\n    %% Styling\n    classDef fastapi fill:#f9f,stroke:#333,stroke-width:2px;\n    classDef services fill:#ccf,stroke:#333,stroke-width:2px;\n    classDef utils fill:#cfc,stroke:#333,stroke-width:2px;\n    classDef external fill:#fcc,stroke:#333,stroke-width:2px;\n    classDef user fill:#ff9,stroke:#333,stroke-width:2px;\n\n    class User User_Interaction;\n    class API_GW,Routes FastAPI_Application;\n    class DamageService,ReportService Core_Services_Utils;\n    class GroqClient,OCR,ImageProc,Fraud,DamageSchemas,ReportSchemas Core_Services_Utils;\n    class GroqCloud,ExternalOCR External_Services;\n```\n\n**Key Components:**\n\n*   **User Interaction:** Represents the client (e.g., a web app, mobile app, or testing tool like curl/Postman) that sends requests.\n*   **FastAPI Application Gateway (`run.py`):** The main entry point of the application, responsible for initializing FastAPI, middleware, and routing.\n*   **API Routes (`src/api/routes.py`):** Defines the HTTP endpoints (e.g., `/assess-damage`, `/generate-accident-report`) and handles incoming request validation, and orchestrates calls to appropriate services.\n*   **Damage Assessment Service (`src/services/groq_service.py`):** Handles the logic for analyzing car damage. This includes preparing prompts, interacting with the Groq API for damage analysis, and processing the LLM response.\n*   **Accident Report Service (`src/services/accident_report_service.py`):** Manages the generation of structured accident reports. It uses OCR, image preprocessing, constructs detailed prompts for the Groq API (including the expected JSON structure), and transforms the LLM output to match the defined Pydantic schemas.\n*   **Groq API Client (within services):** The component (part of both `groq_service.py` and `accident_report_service.py`) responsible for making HTTP requests to the Groq Cloud LLM API.\n*   **OCR Utils (`src/utils/ocr_utils.py`):** Provides optical character recognition capabilities to extract text and checkbox data from European Accident Statement forms.\n*   **Image Processing Utils (`src/utils/image_utils.py`):** Contains functions for image validation, resizing, and specific preprocessing for accident report forms.\n*   **Fraud Detection Utils (`src/utils/fraud_detection.py`):** Includes logic to extract image metadata and detect potential signs of image manipulation.\n*   **Pydantic Schemas (`src/schemas/`):** Define the data structures (request and response models) for both damage assessment and accident reports, ensuring data validation and serialization.\n*   **Groq Cloud LLM API:** The external Large Language Model service that performs the core AI analysis based on the provided images and prompts.\n*   **External/Internal OCR Engine:** The underlying OCR technology used by `ocr_utils.py` (e.g., Tesseract, or cloud-based OCR).\n
This diagram shows how these components are interconnected to process an image and generate the desired JSON output for the different API endpoints.\n 